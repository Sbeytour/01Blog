<mat-card class="post-card" (click)="navigateToPost($event)">
    <mat-card-header class="post-header">
        <div class="header-container">
            <div class="header-info" (click)="navigateToProfile($event)">
                <div class="user-pic">
                    @if (profilePic()) {
                    <img [src]="profilePic()" alt="profilepic" class="profile-pic">
                    } @else {
                    <div class="default-avatar">
                        <mat-icon>account_circle</mat-icon>
                    </div>
                    }
                </div>

                <div class="user-details">
                    <h3 class="full-name">{{ fullName() }}</h3>
                    <p class="username">@{{ post.creator.username }}</p>
                </div>
            </div>
        </div>

        <div class="header-container-right">
            <div class="post-menu" (click)="$event.stopPropagation()">
                <button matIconButton [matMenuTriggerFor]="menu" aria-label="Post options">
                    <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #menu="matMenu" xPosition="before">
                    @if (isOwnPost()) {
                    <button mat-menu-item (click)="onEdit($event)">
                        <mat-icon>edit</mat-icon>
                        <span>Edit</span>
                    </button>
                    <button mat-menu-item (click)="onDelete($event)" class="delete-post">
                        <mat-icon>delete</mat-icon>
                        <span>Delete</span>
                    </button>
                    } @else {
                    <button mat-menu-item (click)="onReport($event)">
                        <mat-icon>flag</mat-icon>
                        <span>Report Post</span>
                    </button>
                    }
                </mat-menu>
            </div>
        </div>
    </mat-card-header>

    <mat-card-content class="post-content">
        <!-- Posts with media: Show title overlay on images -->
        @if (post.media && post.media.length > 0) {
            <div class="media-preview">
                <div class="media-grid" [class.single-media]="post.media.length === 1"
                    [class.two-media]="post.media.length === 2" [class.three-plus-media]="post.media.length >= 3">
                    @for (media of post.media.slice(0, 3); track $index) {
                    <div class="media-item">
                        <!-- Image -->
                        @if (media.type === 'IMAGE') {
                        <img [src]="media.url" [alt]="'Post image ' + ($index + 1)" class="media-image" />
                        }

                        <!-- Video -->
                        @if (media.type === 'VIDEO'){
                        <video [src]="media.url" class="media-video" controls
                            (click)="$event.stopPropagation()"></video>
                        }

                        <!-- Show +N overlay for additional media -->
                        @if ($index === 2 && post.media.length > 3) {
                        <div class="more-media-overlay">
                            <span>+{{ post.media.length - 3 }}</span>
                        </div>
                        }
                    </div>
                    }
                </div>
            </div>

            <!-- Title overlay on media -->
            <div class="post-title-media">
                <h3>{{ getTruncatedText(post.title) }}</h3>
            </div>
        } @else {
            <!-- Posts without media: Show title and content -->
            <mat-card-title class="post-title">
                {{ getTruncatedText(post.title) }}
            </mat-card-title>

            <div class="text-content">
                <p>{{ getTruncatedText(post.content) }}</p>
            </div>
        }
    </mat-card-content>

    <mat-divider class="content-divider"></mat-divider>

    <mat-card-footer class="post-footer">
        <div class="footer-stats">
            <div class="stat-item likes" (click)="onLikeToggle($event)">
                <button matIconButton [disabled]="isLiking()" class="like-button" aria-label="Like post">
                    <mat-icon [class.liked]="post.isLikedByCurrentUser">
                        {{ post.isLikedByCurrentUser ? 'favorite' : 'favorite_border' }}
                    </mat-icon>
                </button>
                <span>{{ post.likesCount }} {{ post.likesCount === 1 ? 'like' : 'likes' }}</span>
            </div>

            <div class="stat-item comments">
                <mat-icon>comment</mat-icon>
                <span>{{ post.commentsCount }} {{ post.commentsCount === 1 ? 'comment' : 'comments' }}</span>
            </div>

            <div class="post-date">
                <span>{{ formatDate(post.createdAt) }}</span>
            </div>
        </div>
    </mat-card-footer>
</mat-card>