<mat-toolbar class="navbar">

    <div class="navbar-left" routerLink="/home">
        <a class="logo-link">
            <h1 class="logo">01</h1>
            <h1 class="title">Blog</h1>
        </a>
    </div>

    <!-- Search Bar -->
    <div class="navbar-center">
        <app-searchBar></app-searchBar>
    </div>

    <div class="navbar-right">
        <button mat-flat-button color="primary" class="create-post-btn" (click)="navigateToCreatePost()">
            <mat-icon>add</mat-icon>
            <span>Create Post</span>
        </button>

        <!-- Notifications -->
        <button mat-icon-button [matMenuTriggerFor]="notificationMenu" class="notification-btn">
            <mat-icon [matBadge]="notificationService.unreadCount() > 0 ? notificationService.unreadCount() : null"
                      matBadgeColor="warn"
                      [matBadgeHidden]="notificationService.unreadCount() === 0">
                notifications
            </mat-icon>
        </button>

        <!-- Notification Dropdown Menu -->
        <mat-menu #notificationMenu="matMenu" class="notification-dropdown">
            <div class="notification-header">
                <span class="notification-title">Notifications</span>
                @if (notificationService.unreadCount() > 0) {
                    <button mat-button (click)="markAllAsRead(); $event.stopPropagation();" class="mark-all-btn">
                        Mark all read
                    </button>
                }
            </div>

            @if (notificationService.isLoading()) {
                <div class="loading-container">
                    <mat-spinner diameter="30"></mat-spinner>
                </div>
            } @else if (notificationService.notifications().length > 0) {
                @for (notif of notificationService.notifications(); track notif.id) {
                    <button mat-menu-item
                            [class.unread]="!notif.isRead"
                            (click)="handleNotificationClick(notif)"
                            class="notification-item-btn">
                        <div class="notification-item">
                            <div class="notification-content">
                                <p class="notification-message">{{ notif.message }}</p>
                                <span class="notification-time">{{ notif.createdAt | date:'short' }}</span>
                            </div>
                            @if (!notif.isRead) {
                                <span class="unread-indicator"></span>
                            }
                        </div>
                    </button>
                    @if (!$last) {
                        <mat-divider></mat-divider>
                    }
                }
            } @else {
                <div class="no-notifications">
                    <mat-icon>notifications_none</mat-icon>
                    <p>No notifications yet</p>
                </div>
            }
        </mat-menu>

        <!-- Theme Toggle -->
        <button mat-icon-button (click)="toggleTheme()">
            <mat-icon>{{ isDarkMode() ? 'dark_mode' : 'light_mode' }}</mat-icon>
        </button>

        <!-- User Menu -->
        <button mat-icon-button [matMenuTriggerFor]="userMenu" class="user-menu-btn">
            @if (authService.currentUser()?.profileImgUrl) {
            <img [src]="authService.currentUser()?.profileImgUrl" [alt]="authService.currentUser()?.username"
                class="user-avatar">
            } @else {
            <mat-icon class="default-avatar">account_circle</mat-icon>
            }
        </button>

        <!-- User Dropdown Menu -->
        <mat-menu #userMenu="matMenu" class="user-dropdown">
            <button mat-menu-item (click)="navigateToProfile()">
                <mat-icon>person</mat-icon>
                <span>My Profile</span>
            </button>

            <!-- Admin Panel (Only for admins) -->
            @if (authService.isAdmin()) {
            <button mat-menu-item (click)="navigateToAdminPanel()">
                <mat-icon>admin_panel_settings</mat-icon>
                <span>Admin Panel</span>
            </button>
            }

            <mat-divider></mat-divider>

            <!-- Logout -->
            <button mat-menu-item (click)="onLogout()" class="logout-btn">
                <mat-icon>logout</mat-icon>
                <span>Logout</span>
            </button>
        </mat-menu>
    </div>
</mat-toolbar>