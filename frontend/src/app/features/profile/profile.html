<app-navbar></app-navbar>

<div class="profile-container">

  <!-- Profile Info Card -->
  <mat-card class="profile-card">
    <div class="profile-header">
      <!-- Avatar Section -->
      <div class="avatar-section">
        @if (profileUser()?.profileImgUrl) {
        <img [src]="profileUser()?.profileImgUrl" [alt]="profileUser()?.username" class="profile-avatar">
        } @else {
        <div class="default-avatar">
          <mat-icon>account_circle</mat-icon>
        </div>
        }
      </div>

      <!-- Profile Info Section -->
      <div class="profile-info">
        <div class="profile-name-section">
          <h1 class="profile-name">{{ profileUser()?.firstName }} {{ profileUser()?.lastName }}</h1>
          <span class="profile-username">&#64;{{ profileUser()?.username }}</span>
        </div>

        <!-- Bio Section -->
        @if (profileUser()?.bio) {
        <p class="profile-bio">{{ profileUser()?.bio }}</p>
        }

        <!-- Stats Section -->
        <div class="profile-stats">
          <div class="stat-item">
            <span class="stat-value">{{ postsCount() }}</span>
            <span class="stat-label">Posts</span>
          </div>
          <mat-divider [vertical]="true"></mat-divider>
          <div class="stat-item">
            <span class="stat-value">{{ followersCount() }}</span>
            <span class="stat-label">Followers</span>
          </div>
          <mat-divider [vertical]="true"></mat-divider>
          <div class="stat-item">
            <span class="stat-value">{{ followingCount() }}</span>
            <span class="stat-label">Following</span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="profile-actions">
          @if (isOwnProfile()) {
          <button mat-flat-button color="primary" (click)="onEditProfile()" class="action-btn">
            <mat-icon>edit</mat-icon>
            <p>Edit Profile</p>
          </button>
          } @else {
          <button mat-flat-button [color]="isFollowedByCurrentUser() ? 'accent' : 'primary'" (click)="onFollowToggle()"
            [disabled]="isFollowLoading()" class="action-btn">
            <mat-icon>{{ isFollowedByCurrentUser() ? 'person_remove' : 'person_add' }}</mat-icon>
            <p>{{ isFollowLoading() ? 'Loading...' : (isFollowedByCurrentUser() ? 'Unfollow' : 'Follow') }}</p>
          </button>
          <button mat-stroked-button color="warn" (click)="onReportUser()" class="action-btn report-btn">
            <mat-icon>flag</mat-icon>
            <p>Report User</p>
          </button>
          }
        </div>
      </div>
    </div>
  </mat-card>

  <div class="content-card">
    @if (isEditing() && isOwnProfile()) {
    <app-profile-edit (editCompleted)="onEditComplet($event)"></app-profile-edit>
    } @else {
    <!-- Posts Section -->
    <div class="posts-section">
      <h2 class="section-title">My Posts :</h2>

      <!-- Loading State -->
      @if (isLoading()) {
      <div class="loading-container">
        <mat-icon class="loading-spinner">refresh</mat-icon>
        <p>Loading posts...</p>
      </div>
      }

      <!-- Error State -->
      @if (errorMessage()) {
      <div class="error-container">
        <mat-icon color="warn">error_outline</mat-icon>
        <p>{{ errorMessage() }}</p>
      </div>
      }

      <!-- Posts Grid -->
      @if (!isLoading() && !errorMessage()) {
      @if (posts().length > 0) {
      <div class="posts-grid">
        @for (post of posts(); track post.id) {
        <app-post-card [post]="post" (postDeleted)="onPostDeleted($event)"
          (postEdited)="onPostEdited($event)"></app-post-card>
        }
      </div>
      } @else {
      <!-- Empty State -->
      <div class="empty-state">
        <mat-icon>post_add</mat-icon>
        <h3>No posts yet</h3>
        <p>{{ isOwnProfile() ? "You haven't created any posts yet." : "This user hasn't posted anything yet." }}</p>
      </div>
      }
      }
    </div>
    }
  </div>
</div>